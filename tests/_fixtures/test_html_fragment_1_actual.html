<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>Actual Browser Behavior - Fragmented Text Nodes</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
        }
        .console-view {
            background: #f0f0f0;
            border: 1px solid #ccc;
            padding: 10px;
            margin: 10px 0;
            font-family: monospace;
        }
        .problem {
            background: #ffeeee;
            padding: 10px;
            border: 1px solid #ff0000;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>Reproducing Browser Console Structure</h1>
    
    <div class="problem">
        <h3>The Problem:</h3>
        <p>When certain web pages render content, they create fragmented text nodes around quotes.</p>
        <p>For example, the text <code>社"DF</code> gets split into:</p>
        <ol>
            <li>&lt;span&gt;社&lt;/span&gt;</li>
            <li>Text node: <code>"</code></li>
            <li>&lt;span&gt;DF&lt;/span&gt;</li>
        </ol>
    </div>

    <h2>Test Cases:</h2>
    
    <!-- Exact reproduction of what's shown in console -->
    <div id="case1">
        <h3>Case 1: Simple Fragment (社"DF)</h3>
        <div class="target"><span>社</span>"<span>DF</span></div>
        <div class="console-view">
            Console shows:
            <pre>
▼ div.target
  ▸ span: "社"
  ▸ text: """
  ▸ span: "DF"
            </pre>
        </div>
    </div>

    <div id="case2">
        <h3>Case 2: The Full String</h3>
        <div class="target">【UCG中字】"數毛社"DF的《戰神4》全新演示解析</div>
        <div class="console-view">
            Expected after processing: 【UCG 中字】"數毛社" DF 的《戰神 4》全新演示解析
        </div>
    </div>

    <div id="case3">
        <h3>Case 3: Complex Fragment</h3>
        <div class="target">
            <span>前面</span>"<span>中间</span>"<span>后面</span>
        </div>
    </div>

    <hr>
    
    <h2>Testing Pangu.js:</h2>
    <button onclick="testPangu()">Apply Pangu.js Spacing</button>
    <button onclick="showNodeStructure()">Show Node Structure</button>
    
    <div id="results"></div>

    <script src="../../dist/browser/pangu.umd.js"></script>
    <script>
        function showNodeStructure() {
            const results = document.getElementById('results');
            results.innerHTML = '<h3>Node Structure Analysis:</h3>';
            
            document.querySelectorAll('.target').forEach((target, index) => {
                results.innerHTML += `<h4>Case ${index + 1}:</h4><pre>`;
                
                function analyzeNode(node, depth = 0) {
                    const indent = '  '.repeat(depth);
                    if (node.nodeType === Node.TEXT_NODE) {
                        results.innerHTML += `${indent}TEXT: "${node.textContent}"\n`;
                    } else if (node.nodeType === Node.ELEMENT_NODE) {
                        results.innerHTML += `${indent}&lt;${node.tagName.toLowerCase()}&gt; "${node.textContent}"\n`;
                        for (let child of node.childNodes) {
                            analyzeNode(child, depth + 1);
                        }
                    }
                }
                
                analyzeNode(target);
                results.innerHTML += '</pre>';
            });
        }

        function testPangu() {
            const results = document.getElementById('results');
            results.innerHTML = '<h3>Pangu.js Processing Results:</h3>';
            
            document.querySelectorAll('.target').forEach((target, index) => {
                const before = target.textContent;
                
                // Clone to preserve original
                const clone = target.cloneNode(true);
                document.body.appendChild(clone);
                clone.style.display = 'none';
                
                // Apply pangu
                window.pangu.spacingNode(clone);
                
                const after = clone.textContent;
                
                results.innerHTML += `
                    <div>
                        <h4>Case ${index + 1}:</h4>
                        <p>Before: <code>${before}</code></p>
                        <p>After: <code>${after}</code></p>
                        <p>HTML: <code>${clone.innerHTML.replace(/</g, '&lt;').replace(/>/g, '&gt;')}</code></p>
                    </div>
                `;
                
                clone.remove();
            });
        }

        // Auto-analyze on load
        window.addEventListener('DOMContentLoaded', showNodeStructure);
    </script>
</body>
</html>